# ADR-001: Bare Repository + Gitfile アーキテクチャの採用

**決定日**: 2025-05-31  
**ステータス**: 採用  

## コンテキスト

従来の git worktree では、メインリポジトリが「特別な存在」として扱われ、他の worktree は「派生物」として位置づけられる。これにより、以下の問題が生じる：

- メイン worktree の削除時に他の worktree が孤立する
- Git オブジェクトの共有が不完全になる
- ディレクトリ構造が非対称になり、理解が困難

## 決定

すべての worktree を対等に扱うため、bare repository を `.bare/` に配置し、各 worktree から gitfile で参照する構造を採用する。

## 根拠

1. **対等性の確保**: すべての worktree が同等の地位を持つ
2. **オブジェクト共有の最大化**: すべての worktree が同一の Git データベースを参照
3. **安全性の向上**: bare repository の誤削除リスクを最小化
4. **Nick Nisi 式の実績**: TypeScript コミュニティでの実証済みアプローチ

## 影響

- **正の影響**:
  - すべての worktree が対等になり、管理が簡素化
  - Git オブジェクトの重複が完全に排除される
  - ディレクトリ構造が理解しやすくなる

- **負の影響**:
  - 初期設定が複雑化する
  - リモート追跡ブランチの手動設定が必要
  - IDE の設定調整が必要な場合がある

- **対応策**:
  - 初期設定とリモート追跡ブランチ設定を自動化
  - IDE 設定のドキュメント化 